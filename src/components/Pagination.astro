---
// src/components/Pagination.astro
import { LIMIT } from "@constants/index.ts";

interface Props {
  totalCount: number;
  current?: number;
  basePath?: string;       // 例: "" | "/docs" | "/news"
  firstPageHref?: string;  // 例: "/" | "/docs" | "/news" | "/search"
  q?: string;
  category?: string;
}

const {
  totalCount,
  current = 1,
  basePath = "",
  firstPageHref,
  q,
  category,
} = Astro.props as Props;

const totalPages = Math.ceil(totalCount / LIMIT);
if (totalPages <= 1) return;

const pages = Array.from({ length: totalPages }).map((_, i) => i + 1);

const getPageUrl = (page: number) => {
  let path: string;

  if (category) {
    // 既存仕様維持
    path = page === 1 ? `/category/${category}` : `/category/${category}/p/${page}`;
  } else {
    // ★ ここが拡張ポイント
    const first = firstPageHref ?? (basePath || "/");
    path = page === 1 ? first : `${basePath}/p/${page}`;
  }

  return q ? `${path}?q=${encodeURIComponent(q)}` : path;
};
---

<ul class="flex justify-center gap-2 py-4">
  {
    pages.map((p) => (
      <li>
        {current !== p ? (
          <a
            href={getPageUrl(p)}
            class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-100 transition"
          >
            {p}
          </a>
        ) : (
          <span class="px-4 py-2 border border-orange-500 bg-orange-500 text-white rounded-md font-bold">
            {p}
          </span>
        )}
      </li>
    ))
  }
</ul>
