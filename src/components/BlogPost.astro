---
// src/components/BlogPost.astro
import FormattedDate from "@components/Date.astro";
import type { Category, CommandGroup } from "@libs/microcms";
const { blog } = Astro.props;
const formatDateJP = (iso: string) => {
  const d = new Date(iso);
  return `${d.getFullYear()}年${d.getMonth() + 1}月${d.getDate()}日`;
};

---

<article class="max-w-none doc-article">
  <header class="mb-4">
    <h1 class="text-4xl md:text-5xl font-semibold tracking-tight leading-[1.15] text-slate-900">
      {blog.title}
    </h1>

    {/* タイトル直下：日付（右寄せ・1行）→ チップ */}
    <div class="mt-3 space-y-2">
      {/* 日付：1行・右寄せ */}
      <div class="text-sm text-slate-500 text-right">
        <span>
          公開日：<FormattedDate date={blog.publishedAt || blog.createdAt} />
        </span>
        {(blog.revisedAt || blog.updatedAt) && (
          <span class="ml-4">
            最終更新日：<FormattedDate date={blog.revisedAt || blog.updatedAt} />
          </span>
        )}
      </div>

      {/* チップ：次の行 */}
      <div class="flex flex-wrap justify-end gap-2">
        {blog.category?.length > 0 ? (
          blog.category.map((cat: Category) => (
            <span class="bg-gray-600 text-white px-3 py-1 rounded-full text-xs">
              {cat.name}
            </span>
          ))
        ) : (
          <span class="text-gray-400 text-xs">No Category</span>
        )}

        {blog.comgr?.length > 0 &&
          blog.comgr.map((g: CommandGroup) => (
            <span
              class="bg-sky-100 text-sky-900 px-3 py-1 rounded-full text-xs border border-sky-200"
              title={g.slug}
            >
              {g.name}
            </span>
          ))}
      </div>
    </div>
  </header>

  <div set:html={blog.content} class="entry-content prose prose-sm md:prose-base max-w-none" />
</article>


<script is:inline>
  (() => {
    const root = document.querySelector(".doc-article");
    if (!root) return;
    const imgs = root.querySelectorAll("img");
    imgs.forEach((img) => {
      img.addEventListener("click", () => {
        img.classList.toggle("is-zoomed");
      });
    });
  })();
</script>
