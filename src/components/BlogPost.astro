---
// src/components/BlogPost.astro
import FormattedDate from "@components/Date.astro";
import type { Category, CommandGroup } from "@libs/microcms";
const { blog } = Astro.props;
const formatDateJP = (iso: string) => {
  const d = new Date(iso);
  return `${d.getFullYear()}年${d.getMonth() + 1}月${d.getDate()}日`;
};

---

<article class="max-w-none">
  {/* ✅ タイトル領域（not-proseでproseの影響を受けない） */}
  <header class="mb-6">
    <h1 class="text-4xl md:text-5xl font-semibold tracking-tight leading-[1.15] text-slate-900">
      {blog.title}
    </h1>

{/* タイトルの直下あたり：チップ（左）＋日付（右） */}
<div class="mt-4 flex flex-wrap items-start justify-between gap-3">
  {/* 左：カテゴリ/コマンドグループ */}
  <div class="flex flex-wrap gap-2">
    {/* カテゴリ（クリック不可） */}
    {blog.category?.length > 0 ? (
      blog.category.map((cat: Category) => (
        <span class="bg-gray-600 text-white px-3 py-1 rounded-full text-xs">
          {cat.name}
        </span>
      ))
    ) : (
      <span class="text-gray-400 text-xs">No Category</span>
    )}

    {/* コマンドグループ */}
    {blog.comgr?.length > 0 &&
      blog.comgr.map((g: CommandGroup) => (
        <span
          class="bg-sky-100 text-sky-900 px-3 py-1 rounded-full text-xs border border-sky-200"
          title={g.slug}
        >
          {g.name}
        </span>
      ))}
  </div>

  {/* 右：日付（右寄せ） */}
  <div class="flex flex-wrap justify-end gap-x-4 gap-y-1 text-sm text-slate-500 text-right">
    <span>
      公開日：<FormattedDate date={blog.publishedAt || blog.createdAt} />
    </span>

    {(blog.revisedAt || blog.updatedAt) && (
      <span>
        最終更新日：<FormattedDate date={blog.revisedAt || blog.updatedAt} />
      </span>
    )}
  </div>
</div>

  </header>

  {/* ✅ 本文だけ prose（本文は少し小さく） */}
  <div set:html={blog.content} class="entry-content prose prose-sm md:prose-base max-w-none" />
</article>

<script is:inline>
  (() => {
    const imgs = document.querySelectorAll('article img');
    imgs.forEach(img => {
      img.addEventListener('click', () => {
        img.classList.toggle('is-zoomed');
      });
    });
  })();
</script>
